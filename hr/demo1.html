<!DOCTYPE html>
<html>
<head>
	<title>Growl</title>
  <script src="http://static.xiaomi.net/99859/miuimarket/module/ext/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
  <style type="text/css" media="screen">
      ul{ margin: 0; padding: 0;}
      body{ background: #000; padding-left: 50px; }
      #box{ position: absolute; border: 1px solid #fff; border-bottom: none; border-right: none;overflow: hidden; }
      #box li{ 
        border-right:  1px solid #fff; 
        border-bottom: 1px solid #fff; 
        float: left;
        list-style: none;
        color: #fff;

      }
      .fill{
        position: absolute;
        left: 0;
        top: 0;
        background: orange;
        color: #fff;
        opacity: 0.9;
      }
  </style>
</head>
<body>
  <button id="btn">Click me!</button><br/ ><br/ >
  <script src="http://static.xiaomi.net/99859/miuimarket/module/ext/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    /*
    * 机器人，数字只能是规则的正方形或者长方形
    */
    var Robot = function(map, width, height) {
      this.HAD_MOVE = 0;  //走过的地方设置为0
      this.map = map;  //传入地图数组
      this.gridWidth = width;
      this.gridHeight = height;
      this.stepNum = 0; //走的步数
      //机器人的定位
      this.position = {
        x: 0,
        y: 0
      }
      this.creatDom();
    }
    Robot.prototype.creatDom = function() {
      var map = this.map;
      var gridLength = 0;
      var box = $("<ul id='box'> </ul>").css({"width": map[0].length * (this.gridWidth + 1) + "px"});  //设定box宽度
      for (var i = 0, ii = map.length; i < ii; i++) {
        for (var j = 0, jj = map[i].length; j < jj; j++) {
          gridLength++;
          box.append("<li style='width:" + this.gridWidth + "px; height:" + this.gridHeight + "px'></li>")
        };
      };
      $('body').append(box);
      this.robot = $("<div id='robot' class='fill' style='width:" + this.gridWidth + "px; height:" + this.gridHeight + "px'></div>")
      box.append(this.robot);
      this.fillNum();
    }
    Robot.prototype.canMoveRight = function() {
      position = this.position;
      if(map[position.y][position.x + 1]) {
        return true;
      } else {
        this.move = this.moveDown;
        return false;
      }
    }
    Robot.prototype.canMoveDown = function() {
      position = this.position;
      if(map[position.y +1] && map[position.y +1][position.x]) {
        return true;
      } else {
        this.move = this.moveLeft;
        return false;
      }
    }
    Robot.prototype.canMoveLeft = function() {
      position = this.position;
      if(map[position.y][position.x -1]) {
        return true;
      } else {
        this.move = this.moveUp;
        return false;
      }
    }
    Robot.prototype.canMoveUp = function() {
      position = this.position;
      if(map[position.y -1] && map[position.y -1][position.x]) {
        return true;
      } else {
        this.move = this.moveRight;
        return false;
      }
    }
    Robot.prototype.moveRight = function() {
      if(this.canMoveRight()) {
        position = this.position;
        map[position.y][position.x] = this.HAD_MOVE;
        this.position.x = this.position.x + 1;
        this.robot.css({
          left: this.position.x * (this.gridWidth + 1) + "px"
        });
      }
    }
    Robot.prototype.moveDown = function() {
      if(this.canMoveDown()) {
        position = this.position;
        map[position.y][position.x] = this.HAD_MOVE;
        this.position.y = this.position.y + 1;
        this.robot.css({
          top: this.position.y * (this.gridHeight + 1) + "px"
        });
      }
    }
    Robot.prototype.moveLeft = function() {
      if(this.canMoveLeft()) {
        position = this.position;
        map[position.y][position.x] = this.HAD_MOVE;
        this.position.x = this.position.x - 1;
        this.robot.css({
          left: this.position.x * (this.gridWidth + 1) + "px"
        });
      }
    }
    Robot.prototype.moveUp = function() {
      if(this.canMoveUp()) {
        position = this.position;
        map[position.y][position.x] = this.HAD_MOVE;
        this.position.y = this.position.y - 1;
        this.robot.css({
          top: this.position.y * (this.gridHeight + 1) + "px"
        });
      }
    }
    //填充数字
    Robot.prototype.fillNum = function() {
      var liIndex = this.position.y * map[0].length + this.position.x + 1;
      $("#box li:nth-child(" + liIndex + ")").text(++this.stepNum);
    }
    Robot.prototype.moveMethod1 = function() {
      if(this.canMoveRight() || this.canMoveDown() || this.canMoveLeft() || this.canMoveUp()) {
        setTimeout(this.moveMethod1.bind(this), 200);
      }
      this.move();
      this.fillNum();
    }
  </script>
  <script type="text/javascript">
    var map = new Array(
      [1, 1, 1, 1, 1],
      [1, 1, 1, 1, 1],
      [1, 1, 1, 1, 1],
      [1, 1, 1, 1, 1],
      [1, 1, 1, 1, 1]
    );
    var myrobot = new Robot(map, 50, 50);
    myrobot.move = myrobot.moveRight;
    $("#btn").click(function() {
      myrobot.moveMethod1();
    })
    </script>
</body>
</html>